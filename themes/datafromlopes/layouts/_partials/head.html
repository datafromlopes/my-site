{{- $siteTitle := .Site.Title -}}
{{- $brandName := or .Site.Params.name .Site.Title -}}
{{- $url := .Permalink -}}
{{- $desc := "MSc in Computer Science @ IME-USP" -}}

{{- $kind := .Kind -}}
{{- $isHome := eq $kind "home" -}}
{{- $isSection := eq $kind "section" -}}
{{- $isTaxonomy := or (eq $kind "taxonomy") (eq $kind "term") -}}

{{- $tabTitle := "" -}}
{{- if $isHome -}}
  {{- $tabTitle = $brandName -}}
{{- else if $isSection -}}
  {{- $tabTitle = printf "%s | %s" (humanize .Section) $brandName -}}
{{- else if $isTaxonomy -}}
  {{- $tabTitle = printf "%s | %s" .Title $brandName -}}
{{- else -}}
  {{- $tabTitle = printf "%s | %s" .Title $brandName -}}
{{- end -}}

{{- $ogTitle := cond $isHome $siteTitle (printf "%s | %s" (or .Title (humanize .Section) $siteTitle) $siteTitle) -}}

{{- $fallback := .Site.Params.defaultImage | absURL -}}
{{- $imgParam := .Params.image -}}
{{- $ogimg := cond $imgParam ($imgParam | absURL) $fallback -}}
{{- $twimg := $ogimg -}}

{{- if .IsPage -}}
  {{- $res := cond (and $imgParam (ne $imgParam "")) (.Resources.GetMatch $imgParam) nil -}}
  {{- if not $res -}}
    {{- $imgs := .Resources.ByType "image" -}}
    {{- if gt (len $imgs) 0 -}}
      {{- $res = index $imgs 0 -}}
    {{- end -}}
  {{- end -}}
  {{- if $res -}}
    {{- $ogProc := $res.Fill "1200x628 center" -}}
    {{- $twProc := $res.Fill "600x600 center" -}}
    {{- if $ogProc -}}{{- $ogimg = $ogProc.Permalink -}}{{- end -}}
    {{- if $twProc -}}{{- $twimg = $twProc.Permalink -}}{{- end -}}
  {{- end -}}
{{- end -}}

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>{{ $tabTitle }}</title>
<meta name="description" content="{{ $desc }}">
<link rel="canonical" href="{{ $url }}"/>

{{- $noindex := false -}}
{{- if or .Draft .Params.noindex -}}{{- $noindex = true -}}{{- end -}}
{{- if and .IsNode .Paginator (gt .Paginator.PageNumber 1) -}}{{- $noindex = true -}}{{- end -}}
<meta name="robots" content="{{ if $noindex }}noindex,follow{{ else }}index,follow{{ end }}"/>

<meta property="og:title" content="{{ $ogTitle }}">
<meta property="og:description" content="{{ $desc }}">
<meta property="og:url" content="{{ $url }}">
<meta property="og:site_name" content="{{ $siteTitle }}">
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:image" content="{{ $ogimg }}">
<meta property="og:locale" content="pt_BR">

<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="{{ $ogTitle }}">
<meta name="twitter:description" content="{{ $desc }}">
<meta name="twitter:image" content="{{ $twimg }}">
<meta name="twitter:image:alt" content="{{ $ogTitle }}">
{{ with .Site.Params.twitter }}<meta name="twitter:site" content="{{ . }}">{{ end }}

{{ partial "jsonld.html" . }}